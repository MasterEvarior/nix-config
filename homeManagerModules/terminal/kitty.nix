{
  lib,
  config,
  osConfig,
  pkgs,
  ...
}:

{
  options.homeModules.terminal.kitty = {
    enable = lib.mkEnableOption "Kitty Terminal Emulator";
    theme = lib.mkOption {
      default = "Catppuccin-Mocha";
      example = "Catppuccin-Mocha";
      type = lib.types.enum [
        "1984_dark"
        "1984_light"
        "1984_orwellian"
        "3024_Day"
        "3024_Night"
        "Adapta_Nokto_Maia"
        "AdventureTime"
        "adwaita_dark"
        "adwaita_darker"
        "adwaita_light"
        "Afterglow"
        "Alabaster"
        "Alabaster_Dark"
        "AlienBlood"
        "Alucard"
        "ANSI-87"
        "Apprentice"
        "Aquarium_Dark"
        "Aquarium_Light"
        "Argonaut"
        "Arthur"
        "atelier-cave-dark"
        "atelier-dune-dark"
        "atelier-estuary-dark"
        "atelier-forest-dark"
        "atelier-heath-dark"
        "atelier-lakeside-dark"
        "atelier-plateau-dark"
        "atelier-savanna-dark"
        "atelier-seaside-dark"
        "atelier-sulphurpool-dark"
        "Atom"
        "AtomOneLight"
        "Ayaka"
        "ayu"
        "ayu_light"
        "ayu_mirage"
        "base2tone-cave-dark"
        "base2tone-desert-dark"
        "base2tone-drawbridge-dark"
        "base2tone-earth-dark"
        "base2tone-evening-dark"
        "base2tone-field-dark"
        "base2tone-forest-dark"
        "base2tone-garden-dark"
        "base2tone-heath-dark"
        "base2tone-lake-dark"
        "base2tone-lavender-dark"
        "base2tone-mall-dark"
        "base2tone-meadow-dark"
        "base2tone-morning-dark"
        "base2tone-motel-dark"
        "base2tone-pool-dark"
        "base2tone-porch-dark"
        "base2tone-sea-dark"
        "base2tone-space-dark"
        "base2tone-suburb-dark"
        "base4tone-classic-d-dark"
        "base4tone-classic-i-dark"
        "base4tone-classic-p-dark"
        "base4tone-classic-s-dark"
        "base4tone-classic-w-dark"
        "base4tone-modern-n-dark"
        "base4tone-modern-w-dark"
        "Batman"
        "Belafonte_Day"
        "Belafonte_Night"
        "BirdsOfParadise"
        "bl1nk"
        "BlackMetal"
        "Blazer"
        "bliss"
        "blueberry-mango"
        "BlulocoDark"
        "BlulocoLight"
        "Borland"
        "Box"
        "breath2"
        "Bright_Lights"
        "Broadcast"
        "Brogrammer"
        "C64"
        "Campbell"
        "Carbonfox"
        "Catppuccin-Frappe"
        "Catppuccin-Latte"
        "Catppuccin-Macchiato"
        "Catppuccin-Mocha"
        "Chalk"
        "Chalkboard"
        "ChallengerDeep"
        "cherry-midnight"
        "cherry"
        "Ciapre"
        "citylights"
        "CLRS"
        "Cobalt2"
        "Cobalt_Neon"
        "Constant_Perceptual_Luminosity_dark"
        "Corvine"
        "CrayonPonyFish"
        "Cyberpunk-Neon"
        "cyberpunk"
        "daintyDark"
        "Dark_Pastel"
        "dark_pride"
        "DarkOneNuanced"
        "Darkside"
        "Dawnfox"
        "Dayfox"
        "default"
        "Desert"
        "DesertNight"
        "DimmedMonokai"
        "Doom_One"
        "Doom_One_Light"
        "Doom_Vibrant"
        "DotGov"
        "Dracula"
        "duckbones"
        "Dumbledore"
        "Duotone_Dark"
        "Duskfox"
        "E-Ink-Dark"
        "E-Ink"
        "Earthsong"
        "Eldritch-dark"
        "Eldritch"
        "Elemental"
        "ENCOM"
        "Espresso"
        "Espresso_Libre"
        "everforest_dark_hard"
        "everforest_dark_medium"
        "everforest_dark_soft"
        "everforest_light_hard"
        "everforest_light_medium"
        "everforest_light_soft"
        "fairyfloss"
        "Falcon"
        "Farin"
        "Fideloper"
        "FishTank"
        "Flat"
        "Flatland"
        "flexoki_dark"
        "flexoki_light"
        "Floraverse"
        "ForestNight"
        "FrontEndDelight"
        "FunForrest"
        "Galaxy"
        "Github"
        "GitHub_Dark"
        "GitHub_Dark_Colorblind"
        "GitHub_Dark_Dimmed"
        "GitHub_Dark_High_Contrast"
        "GitHub_Light"
        "GitHub_Light_Colorblind"
        "GitHub_Light_High_Contrast"
        "Glacier"
        "Gnome-ish_gray-on-black"
        "GnomeLight"
        "GoaBase"
        "Grape"
        "graphite"
        "Grass"
        "gruvbox-dark-hard"
        "gruvbox-dark-soft"
        "gruvbox-dark"
        "gruvbox-light-hard"
        "gruvbox-light-soft"
        "gruvbox-light"
        "GruvboxMaterialDarkHard"
        "GruvboxMaterialDarkMedium"
        "GruvboxMaterialDarkSoft"
        "GruvboxMaterialLightHard"
        "GruvboxMaterialLightMedium"
        "GruvboxMaterialLightSoft"
        "h_pux"
        "HachikoRed"
        "Hardcore"
        "Harper"
        "Highway"
        "Hipster_Green"
        "Homebrew"
        "Hurtado"
        "Hybrid"
        "IC_Green_PPL"
        "IC_Orange_PPL"
        "idleToes"
        "IR_Black"
        "Jackie_Brown"
        "Japanesque"
        "Jellybeans"
        "JetBrains_Darcula"
        "kanagawa"
        "kanagawa_dragon"
        "kanagawa_light"
        "kanagawabones"
        "Kaolin_Aurora"
        "Kaolin_Breeze"
        "Kaolin_Dark"
        "Kaolin_Galaxy"
        "Kaolin_Light"
        "Kaolin_Ocean"
        "Kaolin_Temple"
        "Kibble"
        "kurayami"
        "Later_This_Evening"
        "Lavandula"
        "leaf_dark"
        "leaf_light"
        "LiquidCarbon"
        "LiquidCarbonTransparent"
        "LiquidCarbonTransparentInverse"
        "Man_Page"
        "Material"
        "MaterialDark"
        "Mathias"
        "mayukai"
        "Medallion"
        "mellow"
        "midsummer-night"
        "mishran"
        "Misterioso"
        "Modus_Operandi"
        "Modus_Operandi_Tinted"
        "Modus_Vivendi"
        "Modus_Vivendi_Tinted"
        "Molokai"
        "MonaLisa"
        "Monoindustrial"
        "Monokai"
        "Monokai_Classic"
        "Monokai_Pro"
        "Monokai"
        "(Filter_Machine)"
        "Monokai"
        "(Filter_Octagon)"
        "Monokai"
        "(Filter_Ristretto)"
        "Monokai"
        "(Filter_Spectrum)"
        "Monokai_Soda"
        "moonlight"
        "N0tch2k"
        "neobones_dark"
        "neobones_light"
        "Neopolitan"
        "Neowave"
        "Neutron"
        "night_owl"
        "nightfly"
        "Nightfox"
        "NightLion_v1"
        "NightLion_v2"
        "noirblaze"
        "noirbuddy-oxide"
        "Nord"
        "Nordfox"
        "Nova"
        "Novel"
        "Obsidian"
        "Ocean"
        "OceanicMaterial"
        "Ollie"
        "OneDark-Pro"
        "OneDark"
        "OneHalfDark"
        "OneHalfLight"
        "outrun_electric"
        "PaperColor_dark"
        "PaperColor_light"
        "Parasio_Dark"
        "PaulMillr"
        "PencilDark"
        "PencilLight"
        "phanes"
        "Piatto_Light"
        "pink_lavender"
        "Pnevma"
        "Pro"
        "purpurite"
        "Red_Alert"
        "Red_Sands"
        "Relaxed_Afterglow"
        "Renault_Style"
        "Renault_Style_Light"
        "Rippedcasts"
        "rose-pine-dawn"
        "rose-pine-moon"
        "rose-pine"
        "Royal"
        "Sakura_Night"
        "Seafoam_Pastel"
        "SeaShells"
        "selenized-black"
        "selenized-dark"
        "selenized-light"
        "selenized-white"
        "seoulbones_dark"
        "seoulbones_light"
        "Seti"
        "shadotheme"
        "Shaman"
        "Sierra"
        "Slate"
        "Smyck"
        "snazzy"
        "SnowDark"
        "SnowLight"
        "SoftServer"
        "Solarized8_Dark"
        "Solarized_Darcula"
        "Solarized_Dark"
        "Solarized_Dark_-_Patched"
        "Solarized_Dark_Higher_Contrast"
        "Solarized_Light"
        "sonokai-sushia"
        "Source_Code_X"
        "Sourcerer"
        "spaceduck"
        "Spacedust"
        "SpaceGray"
        "SpaceGray_Eighties"
        "SpaceGray_Eighties_Dull"
        "Spacemacs"
        "Spiderman"
        "Spring"
        "Square"
        "Srcery"
        "Substrata"
        "Sundried"
        "Symfonic"
        "Tango_Dark"
        "Tango_Light"
        "Teerb"
        "tender"
        "Terafox"
        "Thayer_Bright"
        "The_Hulk"
        "tokyo_night_day"
        "tokyo_night_moon"
        "tokyo_night_night"
        "tokyo_night_storm"
        "Tomorrow"
        "Tomorrow_Night"
        "Tomorrow_Night_Blue"
        "Tomorrow_Night_Bright"
        "Tomorrow_Night_Eighties"
        "ToyChest"
        "Treehouse"
        "Twilight"
        "Ubuntu"
        "Urple"
        "vague"
        "Vaughn"
        "VibrantInk"
        "vimbones"
        "VSCode_Dark"
        "WarmNeon"
        "Wez"
        "WildCherry"
        "wizzy-bright"
        "wizzy-muted"
        "Wombat"
        "Wood"
        "Wryan"
        "xcodedark"
        "yorumi-abyss"
        "yorumi-kraken"
        "yorumi-mist"
        "yorumi-shade"
        "YsDark"
        "zenbones_dark"
        "zenbones_light"
        "Zenburn"
        "zenburned"
        "zenwritten_dark"
        "zenwritten_light"
      ];
      description = "Which official Kitty theme to apply";
    };
    font = lib.mkOption {
      default = pkgs.nerd-fonts.jetbrains-mono;
      example = pkgs.nerd-fonts.jetbrains-mono;
      type = lib.types.package;
      description = "Package of the font which should be used";
    };
  };

  config =
    let
      cfg = config.homeModules.terminal.kitty;
      isDefaultShell = shellPkg: (osConfig.users.defaultUserShell == shellPkg);
    in
    lib.mkIf config.homeModules.terminal.kitty.enable {
      programs.kitty = {
        enable = true;
        shellIntegration = {
          enableZshIntegration = isDefaultShell pkgs.zsh;
          enableBashIntegration = isDefaultShell pkgs.bash;
          enableFishIntegration = isDefaultShell pkgs.fish;
        };
        font = {
          package = cfg.font;
          name = cfg.font.pname;
        };
        themeFile = cfg.theme;
      };

      homeModules.desktop.sway = rec {
        terminal = "${pkgs.kitty}/bin/kitty";
        fileBrowser = terminal + " -e ${pkgs.yazi}/bin/yazi";
      };
    };
}
